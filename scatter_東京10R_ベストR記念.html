<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>クッション値×含水率 - 東京</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans JP', sans-serif;
  background: #fff; color: #1e293b; overflow: hidden; height: 100vh;
}
.header {
  background: #fff; border-bottom: 1px solid #e2e8f0;
  padding: 12px 16px; z-index: 100;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05); flex-shrink: 0;
}
.header h1 { font-size: 16px; font-weight: 900; letter-spacing: -0.5px; }
.header .sub { font-size: 11px; color: #64748b; margin-top: 2px; }
.header .target {
  display: inline-flex; gap: 12px; margin-top: 4px;
  font-size: 11px; font-weight: 700; font-family: monospace;
}
.header .target span {
  background: #f8fafc; border: 1px solid #e2e8f0;
  padding: 2px 8px; border-radius: 4px;
}
.main { display: flex; flex-direction: column; flex: 1; overflow: hidden; }
@media (min-width: 768px) { .main { flex-direction: row; } }
.chart-area { position: relative; width: 100%; height: 40vh; min-height: 250px; flex-shrink: 0; }
@media (min-width: 768px) { .chart-area { flex: 1; height: 100%; } }
canvas { display: block; width: 100% !important; height: 100% !important; touch-action: pan-y; }
.panel {
  border-top: 1px solid #e2e8f0; overflow-y: auto; padding: 8px 8px 80px 8px; background: #f8fafc;
  flex: 1;
}
@media (min-width: 768px) {
  .panel { width: 320px; border-top: none; border-left: 1px solid #e2e8f0; }
}
.horse-btn {
  display: flex; align-items: center; gap: 10px; width: 100%;
  padding: 10px 14px; margin-bottom: 4px; border: 1px solid #e2e8f0;
  border-radius: 12px; background: #fff; cursor: pointer;
  transition: all 0.2s; font-size: 14px; font-weight: 700; color: #1e293b;
  -webkit-tap-highlight-color: transparent;
}
.horse-btn:active { transform: scale(0.98); }
.horse-btn.selected {
  border-color: #f59e0b; background: #fffbeb;
  box-shadow: 0 0 0 2px rgba(245,158,11,0.2);
}
.horse-btn .count { font-size: 10px; color: #94a3b8; font-weight: 600; margin-left: auto; }
.horse-btn .dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.rating-row {
  display: flex; gap: 4px; padding: 4px 14px 8px 22px;
}
.rating-btn {
  width: 32px; height: 28px; border: 1.5px solid #cbd5e1; border-radius: 6px;
  background: #fff; cursor: pointer; font-size: 12px; font-weight: 800;
  color: #94a3b8; transition: all 0.15s; -webkit-tap-highlight-color: transparent;
}
.rating-btn:active { transform: scale(0.92); }
.rating-btn.rated-S { background: #dc2626; border-color: #dc2626; color: #fff; }
.rating-btn.rated-A { background: #f59e0b; border-color: #f59e0b; color: #fff; }
.rating-btn.rated-B { background: #3b82f6; border-color: #3b82f6; color: #fff; }
.rating-btn.rated-C { background: #22c55e; border-color: #22c55e; color: #fff; }
.rating-btn.rated-D { background: #94a3b8; border-color: #94a3b8; color: #fff; }
.horse-detail { display: none; padding: 8px 4px; }
.horse-detail.show { display: block; }
.race-card { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 6px; }
.race-item {
  padding: 8px 10px; border-radius: 10px; border: 1px solid #e2e8f0;
  background: #fff; font-size: 10px; cursor: pointer;
}
.race-item.ideal { background: #ecfdf5; border-color: #a7f3d0; }
.race-item.highlighted { border-color: #f59e0b; box-shadow: 0 0 0 2px rgba(245,158,11,0.3); }
.race-item .date { color: #94a3b8; font-weight: 600; font-family: monospace; }
.race-item .rname { color: #1e293b; font-weight: 700; font-size: 10px; margin-top: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.race-item .result { font-size: 13px; font-weight: 900; }
.race-item .cond { color: #64748b; font-weight: 700; }
.legend {
  display: flex; gap: 12px; padding: 8px 16px; font-size: 10px;
  font-weight: 700; color: #94a3b8; border-top: 1px solid #e2e8f0; flex-wrap: wrap;
}
.legend span { display: flex; align-items: center; gap: 4px; }
.legend .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
.tooltip {
  display: none; position: fixed; background: rgba(15,23,42,0.95); color: #fff;
  padding: 10px 14px; border-radius: 10px; font-size: 12px; line-height: 1.6;
  pointer-events: none; z-index: 200; max-width: 250px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.tooltip.show { display: block; }
</style>
</head>
<body style="display:flex;flex-direction:column;">
<div class="header">
  <h1>東京10R  芝2000m</h1>
  <div class="sub">出走馬 クッション値×含水率 解析</div>
  <div class="target">
    <span>CV: <b style="color:#d97706">9.7</b></span>
    <span>含水率: <b style="color:#2563eb">12.1%</b></span>
    <span style="color:#94a3b8">02/22 東京</span>
  </div>
</div>
<div class="main">
  <div class="chart-area"><canvas id="chart"></canvas><div class="tooltip" id="tooltip"></div></div>
  <div class="panel" id="panel"></div>
</div>
<div class="legend">
  <span><span class="dot" style="background:#dc2626"></span> 同距離芝</span>
  <span><span class="dot" style="background:#2563eb"></span> 他距離芝</span>
  <span><span class="dot" style="background:#94a3b8"></span> ダート</span>
  <span>○ 3着以内 / × 4着以下</span>
</div>
<script>
const HORSES = [{"name": "ブランデーロック", "races": [{"date": "2026/01/18", "venue": "中山", "surface": "芝", "distance": 1600, "race_name": "若潮S(3勝クラス)", "result": 10, "cushion": 10.5, "moisture": 11.3, "cat": "diff_dist", "good": false}, {"date": "2026/01/04", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "日刊スポ賞中山金杯(GIII)", "result": 9, "cushion": 9.4, "moisture": 12.5, "cat": "same_dist", "good": false}, {"date": "2025/11/09", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "イクイノックスM(3勝クラス)", "result": 12, "cushion": 9.1, "moisture": 13.0, "cat": "same_dist", "good": false}, {"date": "2025/10/19", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "甲斐路S(3勝クラス)", "result": 7, "cushion": 9.6, "moisture": 13.4, "cat": "diff_dist", "good": false}, {"date": "2025/08/31", "venue": "札幌", "surface": "芝", "distance": 1500, "race_name": "日高S(3勝クラス)", "result": 12, "cushion": 7.5, "moisture": 15.6, "cat": "diff_dist", "good": false}, {"date": "2025/06/01", "venue": "京都", "surface": "芝", "distance": 1400, "race_name": "安土城S(L)", "result": 10, "cushion": 11.3, "moisture": 8.2, "cat": "diff_dist", "good": false}, {"date": "2025/05/10", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "分倍河原S(3勝クラス)", "result": 15, "cushion": 8.9, "moisture": 13.4, "cat": "diff_dist", "good": false}, {"date": "2025/05/04", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "府中S(3勝クラス)", "result": 6, "cushion": 9.4, "moisture": 14.4, "cat": "same_dist", "good": false}, {"date": "2025/04/12", "venue": "中山", "surface": "芝", "distance": 1600, "race_name": "あけぼのS(3勝クラス)", "result": 8, "cushion": 9.4, "moisture": 13.2, "cat": "diff_dist", "good": false}, {"date": "2025/04/06", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "美浦S(3勝クラス)", "result": 4, "cushion": 9.5, "moisture": 12.6, "cat": "same_dist", "good": false}]}, {"name": "ウインオーディン", "races": [{"date": "2025/11/30", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "ウェルカムS(3勝クラス)", "result": 2, "cushion": 9.3, "moisture": 14.9, "cat": "same_dist", "good": true}, {"date": "2025/10/25", "venue": "新潟", "surface": "芝", "distance": 2000, "race_name": "魚沼S(3勝クラス)", "result": 5, "cushion": 9.4, "moisture": 10.5, "cat": "same_dist", "good": false}, {"date": "2025/08/30", "venue": "新潟", "surface": "芝", "distance": 2200, "race_name": "日本海S(3勝クラス)", "result": 2, "cushion": 9.4, "moisture": 10.6, "cat": "diff_dist", "good": true}, {"date": "2025/06/28", "venue": "福島", "surface": "芝", "distance": 2000, "race_name": "バーデンバーデンC(3勝クラス)", "result": 7, "cushion": 9.0, "moisture": 10.9, "cat": "same_dist", "good": false}, {"date": "2025/06/01", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "むらさき賞(3勝クラス)", "result": 13, "cushion": 9.2, "moisture": 17.7, "cat": "diff_dist", "good": false}, {"date": "2025/05/04", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "府中S(3勝クラス)", "result": 7, "cushion": 9.4, "moisture": 14.4, "cat": "same_dist", "good": false}, {"date": "2025/01/06", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "寿S(3勝クラス)", "result": 17, "cushion": 9.4, "moisture": 10.7, "cat": "same_dist", "good": false}, {"date": "2024/11/24", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "アーモンドアイC(3勝クラス)", "result": 3, "cushion": 9.4, "moisture": 16.7, "cat": "same_dist", "good": true}, {"date": "2024/11/02", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "3歳以上2勝クラス", "result": 1, "cushion": 9.7, "moisture": 13.5, "cat": "same_dist", "good": true}, {"date": "2024/09/15", "venue": "中京", "surface": "芝", "distance": 2200, "race_name": "茶臼山高原特別(2勝クラス)", "result": 3, "cushion": 9.1, "moisture": 14.4, "cat": "diff_dist", "good": true}]}, {"name": "レイニング", "races": [{"date": "2025/11/30", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "オリエンタル賞(2勝クラス)", "result": 1, "cushion": 9.3, "moisture": 14.9, "cat": "same_dist", "good": true}, {"date": "2025/10/25", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "3歳以上1勝クラス", "result": 1, "cushion": 9.6, "moisture": 14.2, "cat": "same_dist", "good": true}, {"date": "2025/08/23", "venue": "新潟", "surface": "芝", "distance": 1600, "race_name": "3歳以上1勝クラス", "result": 4, "cushion": 9.3, "moisture": 11.6, "cat": "diff_dist", "good": false}, {"date": "2025/05/04", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "プリンシパルS(L)", "result": 13, "cushion": 9.4, "moisture": 14.4, "cat": "same_dist", "good": false}, {"date": "2024/11/03", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "2歳新馬", "result": 1, "cushion": 9.7, "moisture": 11.9, "cat": "diff_dist", "good": true}]}, {"name": "パンジャ", "races": [{"date": "2025/11/30", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "ウェルカムS(3勝クラス)", "result": 3, "cushion": 9.3, "moisture": 14.9, "cat": "same_dist", "good": true}, {"date": "2025/09/06", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "白井特別(2勝クラス)", "result": 1, "cushion": 9.6, "moisture": 14.2, "cat": "same_dist", "good": true}, {"date": "2025/04/26", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "石和特別(2勝クラス)", "result": 3, "cushion": 9.5, "moisture": 12.3, "cat": "diff_dist", "good": true}, {"date": "2025/03/29", "venue": "中山", "surface": "芝", "distance": 1800, "race_name": "4歳以上2勝クラス", "result": 4, "cushion": 9.6, "moisture": 12.6, "cat": "diff_dist", "good": false}, {"date": "2025/03/02", "venue": "中山", "surface": "芝", "distance": 1800, "race_name": "富里特別(2勝クラス)", "result": 4, "cushion": 10.1, "moisture": 10.9, "cat": "diff_dist", "good": false}, {"date": "2024/12/28", "venue": "中山", "surface": "芝", "distance": 1800, "race_name": "3歳以上1勝クラス", "result": 1, "cushion": 9.5, "moisture": 12.5, "cat": "diff_dist", "good": true}, {"date": "2024/12/07", "venue": "中山", "surface": "芝", "distance": 1800, "race_name": "3歳以上1勝クラス", "result": 2, "cushion": 10.2, "moisture": 12.6, "cat": "diff_dist", "good": true}, {"date": "2024/11/16", "venue": "福島", "surface": "芝", "distance": 2000, "race_name": "3歳以上1勝クラス", "result": 2, "cushion": 9.5, "moisture": 11.0, "cat": "same_dist", "good": true}, {"date": "2024/10/27", "venue": "新潟", "surface": "芝", "distance": 2000, "race_name": "湯沢特別(1勝クラス)", "result": 7, "cushion": 9.3, "moisture": 13.2, "cat": "same_dist", "good": false}, {"date": "2024/09/16", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "朝日セントライト記念(GII)", "result": 8, "cushion": 9.5, "moisture": 14.4, "cat": "diff_dist", "good": false}]}, {"name": "ユキワリザクラ", "races": [{"date": "2025/11/16", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "ユートピアS(3勝クラス)", "result": 3, "cushion": 9.3, "moisture": 12.1, "cat": "diff_dist", "good": true}, {"date": "2025/07/20", "venue": "福島", "surface": "芝", "distance": 2000, "race_name": "猪苗代特別(2勝クラス)", "result": 1, "cushion": 9.2, "moisture": 11.4, "cat": "same_dist", "good": true}, {"date": "2025/06/28", "venue": "福島", "surface": "芝", "distance": 2000, "race_name": "松島特別(2勝クラス)", "result": 2, "cushion": 9.0, "moisture": 10.9, "cat": "same_dist", "good": true}, {"date": "2025/04/26", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "石和特別(2勝クラス)", "result": 2, "cushion": 9.5, "moisture": 12.3, "cat": "diff_dist", "good": true}, {"date": "2025/02/09", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "4歳以上2勝クラス", "result": 2, "cushion": 9.5, "moisture": 14.2, "cat": "diff_dist", "good": true}, {"date": "2024/11/10", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "3歳以上1勝クラス", "result": 1, "cushion": 9.7, "moisture": 11.9, "cat": "diff_dist", "good": true}, {"date": "2024/04/21", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "サンスポ賞フローラS(GII)", "result": 12, "cushion": 9.2, "moisture": 16.4, "cat": "same_dist", "good": false}, {"date": "2024/03/03", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "3歳未勝利", "result": 1, "cushion": 8.9, "moisture": 13.4, "cat": "same_dist", "good": true}, {"date": "2023/12/28", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "2歳新馬", "result": 3, "cushion": 9.0, "moisture": 12.3, "cat": "same_dist", "good": true}]}, {"name": "ログラール", "races": [{"date": "2026/02/01", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "4歳以上2勝クラス", "result": 1, "cushion": 9.7, "moisture": 12.3, "cat": "same_dist", "good": true}, {"date": "2025/11/30", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "オリエンタル賞(2勝クラス)", "result": 3, "cushion": 9.3, "moisture": 14.9, "cat": "same_dist", "good": true}, {"date": "2025/03/29", "venue": "中京", "surface": "ダ", "distance": 1800, "race_name": "矢作川特別(2勝クラス)", "result": 13, "cushion": 8.6, "moisture": 11.6, "cat": "diff_surface", "good": false}, {"date": "2025/02/16", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "春日特別(2勝クラス)", "result": 4, "cushion": 9.5, "moisture": 11.3, "cat": "same_dist", "good": false}, {"date": "2025/02/01", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "許波多特別(2勝クラス)", "result": 6, "cushion": 10.8, "moisture": 8.6, "cat": "diff_dist", "good": false}, {"date": "2024/11/24", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "オリエンタル賞(2勝クラス)", "result": 3, "cushion": 9.4, "moisture": 16.7, "cat": "same_dist", "good": true}, {"date": "2024/09/16", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "朝日セントライト記念(GII)", "result": 10, "cushion": 9.5, "moisture": 14.4, "cat": "diff_dist", "good": false}, {"date": "2024/06/30", "venue": "福島", "surface": "芝", "distance": 1800, "race_name": "ラジオNIKKEI賞(GIII)", "result": 6, "cushion": 9.2, "moisture": 10.8, "cat": "diff_dist", "good": false}, {"date": "2024/04/14", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "3歳1勝クラス", "result": 1, "cushion": 9.5, "moisture": 9.4, "cat": "same_dist", "good": true}, {"date": "2024/03/17", "venue": "中山", "surface": "芝", "distance": 1800, "race_name": "フジTVスプリングS(GII)", "result": 8, "cushion": 9.7, "moisture": 11.9, "cat": "diff_dist", "good": false}]}, {"name": "グーテンベルク", "races": [{"date": "2025/12/13", "venue": "中山", "surface": "芝", "distance": 1800, "race_name": "常総S(3勝クラス)", "result": 3, "cushion": 10.3, "moisture": 10.1, "cat": "diff_dist", "good": true}, {"date": "2025/09/27", "venue": "中山", "surface": "芝", "distance": 1600, "race_name": "秋風S(3勝クラス)", "result": 10, "cushion": 10.2, "moisture": 12.1, "cat": "diff_dist", "good": false}, {"date": "2025/06/15", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "芦ノ湖特別(2勝クラス)", "result": 1, "cushion": 8.7, "moisture": 17.7, "cat": "diff_dist", "good": true}, {"date": "2025/02/23", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "3歳1勝クラス", "result": 1, "cushion": 9.5, "moisture": 12.7, "cat": "diff_dist", "good": true}, {"date": "2024/11/23", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "2歳新馬", "result": 1, "cushion": 9.5, "moisture": 16.3, "cat": "diff_dist", "good": true}]}, {"name": "サクラファレル", "races": [{"date": "2025/09/15", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "朝日セントライト記念(GII)", "result": 5, "cushion": 9.9, "moisture": 12.2, "cat": "diff_dist", "good": false}, {"date": "2025/08/09", "venue": "札幌", "surface": "芝", "distance": 2000, "race_name": "藻岩山特別(2勝クラス)", "result": 1, "cushion": 7.0, "moisture": 13.5, "cat": "same_dist", "good": true}, {"date": "2025/07/19", "venue": "函館", "surface": "芝", "distance": 1800, "race_name": "湯浜特別(1勝クラス)", "result": 1, "cushion": 7.9, "moisture": 15.0, "cat": "diff_dist", "good": true}, {"date": "2025/06/22", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "3歳未勝利", "result": 1, "cushion": 9.6, "moisture": 12.3, "cat": "diff_dist", "good": true}, {"date": "2025/03/29", "venue": "中山", "surface": "芝", "distance": 1800, "race_name": "3歳未勝利", "result": 2, "cushion": 9.6, "moisture": 12.6, "cat": "diff_dist", "good": true}, {"date": "2025/03/16", "venue": "中京", "surface": "芝", "distance": 2200, "race_name": "3歳未勝利", "result": 2, "cushion": 7.9, "moisture": 13.7, "cat": "diff_dist", "good": true}]}, {"name": "ダニーデン", "races": [{"date": "2026/01/17", "venue": "中山", "surface": "ダ", "distance": 1800, "race_name": "アレキサンドライトS(3勝クラス)", "result": 12, "cushion": 10.1, "moisture": 1.3, "cat": "diff_surface", "good": false}, {"date": "2025/11/08", "venue": "東京", "surface": "ダ", "distance": 1600, "race_name": "錦秋S(3勝クラス)", "result": 11, "cushion": 9.2, "moisture": 2.8, "cat": "diff_surface", "good": false}, {"date": "2025/09/14", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "レインボーS(3勝クラス)", "result": 12, "cushion": 9.8, "moisture": 12.9, "cat": "same_dist", "good": false}, {"date": "2025/07/19", "venue": "福島", "surface": "芝", "distance": 1800, "race_name": "阿武隈S(3勝クラス)", "result": 9, "cushion": 9.3, "moisture": 11.4, "cat": "diff_dist", "good": false}, {"date": "2024/11/24", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "アーモンドアイC(3勝クラス)", "result": 15, "cushion": 9.4, "moisture": 16.7, "cat": "same_dist", "good": false}, {"date": "2024/01/06", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "迎春S(3勝クラス)", "result": 6, "cushion": 10.4, "moisture": 11.0, "cat": "diff_dist", "good": false}, {"date": "2023/11/26", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "アーモンドアイM(2勝クラス)", "result": 1, "cushion": 9.7, "moisture": 13.5, "cat": "same_dist", "good": true}, {"date": "2023/10/07", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "3歳以上1勝クラス", "result": 1, "cushion": 9.1, "moisture": 14.5, "cat": "same_dist", "good": true}, {"date": "2023/07/15", "venue": "福島", "surface": "芝", "distance": 2000, "race_name": "南相馬特別(1勝クラス)", "result": 10, "cushion": 9.2, "moisture": 10.9, "cat": "same_dist", "good": false}, {"date": "2023/04/15", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "山藤賞(1勝クラス)", "result": 3, "cushion": 9.3, "moisture": 8.2, "cat": "same_dist", "good": true}]}, {"name": "マルチャン", "races": [{"date": "2026/01/18", "venue": "中山", "surface": "芝", "distance": 1600, "race_name": "若潮S(3勝クラス)", "result": 9, "cushion": 10.5, "moisture": 11.3, "cat": "diff_dist", "good": false}, {"date": "2025/12/28", "venue": "中山", "surface": "芝", "distance": 1600, "race_name": "2025ファイナルS(3勝クラス)", "result": 13, "cushion": 9.5, "moisture": 11.3, "cat": "diff_dist", "good": false}, {"date": "2025/10/19", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "甲斐路S(3勝クラス)", "result": 13, "cushion": 9.6, "moisture": 13.4, "cat": "diff_dist", "good": false}, {"date": "2025/08/10", "venue": "新潟", "surface": "芝", "distance": 1800, "race_name": "佐渡S(3勝クラス)", "result": 7, "cushion": 9.5, "moisture": 11.2, "cat": "diff_dist", "good": false}, {"date": "2025/06/01", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "むらさき賞(3勝クラス)", "result": 7, "cushion": 9.2, "moisture": 17.7, "cat": "diff_dist", "good": false}, {"date": "2025/05/18", "venue": "新潟", "surface": "芝", "distance": 1800, "race_name": "弥彦S(3勝クラス)", "result": 2, "cushion": 9.0, "moisture": 13.1, "cat": "diff_dist", "good": true}, {"date": "2025/03/15", "venue": "中山", "surface": "芝", "distance": 1600, "race_name": "幕張S(3勝クラス)", "result": 5, "cushion": 9.8, "moisture": 10.6, "cat": "diff_dist", "good": false}, {"date": "2025/02/16", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "雲雀S(3勝クラス)", "result": 11, "cushion": 9.3, "moisture": 13.4, "cat": "diff_dist", "good": false}, {"date": "2024/12/08", "venue": "中山", "surface": "芝", "distance": 1600, "race_name": "3歳以上2勝クラス", "result": 1, "cushion": 10.0, "moisture": 12.4, "cat": "diff_dist", "good": true}, {"date": "2024/11/09", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "3歳以上2勝クラス", "result": 4, "cushion": 9.7, "moisture": 13.5, "cat": "diff_dist", "good": false}]}, {"name": "ライトトラック", "races": [{"date": "2026/02/01", "venue": "京都", "surface": "芝", "distance": 2200, "race_name": "八坂S(3勝クラス)", "result": 7, "cushion": 10.7, "moisture": 9.5, "cat": "diff_dist", "good": false}, {"date": "2025/10/26", "venue": "京都", "surface": "芝", "distance": 3000, "race_name": "菊花賞(GI)", "result": 12, "cushion": 9.7, "moisture": 12.0, "cat": "diff_dist", "good": false}, {"date": "2025/09/21", "venue": "阪神", "surface": "芝", "distance": 2400, "race_name": "神戸新聞杯(GII)", "result": 5, "cushion": 9.2, "moisture": 11.6, "cat": "diff_dist", "good": false}, {"date": "2025/06/01", "venue": "京都", "surface": "芝", "distance": 1800, "race_name": "白百合S(L)", "result": 1, "cushion": 11.3, "moisture": 8.2, "cat": "diff_dist", "good": true}, {"date": "2025/05/10", "venue": "京都", "surface": "芝", "distance": 1800, "race_name": "3歳未勝利", "result": 1, "cushion": 9.6, "moisture": 11.6, "cat": "diff_dist", "good": true}]}, {"name": "ウイントレメンデス", "races": [{"date": "2026/01/04", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "寿S(3勝クラス)", "result": 2, "cushion": 10.7, "moisture": 8.6, "cat": "same_dist", "good": true}, {"date": "2025/11/22", "venue": "京都", "surface": "芝", "distance": 2400, "race_name": "比叡S(3勝クラス)", "result": 3, "cushion": 10.7, "moisture": 7.9, "cat": "diff_dist", "good": true}, {"date": "2025/10/04", "venue": "京都", "surface": "芝", "distance": 2000, "race_name": "3歳以上2勝クラス", "result": 1, "cushion": 9.4, "moisture": 10.6, "cat": "same_dist", "good": true}, {"date": "2025/09/06", "venue": "札幌", "surface": "芝", "distance": 2000, "race_name": "富良野特別(1勝クラス)", "result": 1, "cushion": 7.7, "moisture": 11.3, "cat": "same_dist", "good": true}, {"date": "2025/04/06", "venue": "阪神", "surface": "芝", "distance": 2000, "race_name": "4歳以上1勝クラス", "result": 7, "cushion": 9.2, "moisture": 13.2, "cat": "same_dist", "good": false}, {"date": "2025/02/23", "venue": "東京", "surface": "芝", "distance": 1800, "race_name": "4歳以上1勝クラス", "result": 2, "cushion": 9.5, "moisture": 12.7, "cat": "diff_dist", "good": true}, {"date": "2025/01/12", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "4歳以上1勝クラス", "result": 4, "cushion": 10.0, "moisture": 12.6, "cat": "diff_dist", "good": false}, {"date": "2024/08/17", "venue": "札幌", "surface": "芝", "distance": 2000, "race_name": "3歳未勝利", "result": 1, "cushion": 7.5, "moisture": 12.4, "cat": "same_dist", "good": true}, {"date": "2024/08/03", "venue": "札幌", "surface": "芝", "distance": 2000, "race_name": "3歳未勝利", "result": 2, "cushion": 7.6, "moisture": 13.6, "cat": "same_dist", "good": true}, {"date": "2024/07/14", "venue": "函館", "surface": "芝", "distance": 2000, "race_name": "3歳未勝利", "result": 2, "cushion": 8.3, "moisture": 13.7, "cat": "same_dist", "good": true}]}, {"name": "ディヴァインスター", "races": [{"date": "2025/12/21", "venue": "中京", "surface": "芝", "distance": 2000, "race_name": "名古屋日刊スポーツ杯(2勝クラス)", "result": 1, "cushion": 9.7, "moisture": 12.8, "cat": "same_dist", "good": true}, {"date": "2025/10/26", "venue": "新潟", "surface": "芝", "distance": 2000, "race_name": "3歳以上1勝クラス", "result": 1, "cushion": 9.3, "moisture": 11.8, "cat": "same_dist", "good": true}, {"date": "2025/09/27", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "3歳以上1勝クラス", "result": 9, "cushion": 10.2, "moisture": 12.1, "cat": "diff_dist", "good": false}, {"date": "2025/08/10", "venue": "新潟", "surface": "芝", "distance": 2000, "race_name": "3歳以上1勝クラス", "result": 3, "cushion": 9.5, "moisture": 11.2, "cat": "same_dist", "good": true}, {"date": "2025/06/15", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "3歳以上1勝クラス", "result": 3, "cushion": 8.7, "moisture": 17.7, "cat": "same_dist", "good": true}, {"date": "2025/03/01", "venue": "中山", "surface": "芝", "distance": 2200, "race_name": "水仙賞(1勝クラス)", "result": 13, "cushion": 10.0, "moisture": 11.9, "cat": "diff_dist", "good": false}, {"date": "2025/01/06", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "3歳1勝クラス", "result": 4, "cushion": 10.1, "moisture": 13.7, "cat": "same_dist", "good": false}, {"date": "2024/11/03", "venue": "東京", "surface": "芝", "distance": 2000, "race_name": "2歳未勝利", "result": 1, "cushion": 9.7, "moisture": 11.9, "cat": "same_dist", "good": true}, {"date": "2024/09/07", "venue": "中山", "surface": "芝", "distance": 2000, "race_name": "2歳新馬", "result": 2, "cushion": 9.9, "moisture": 13.2, "cat": "same_dist", "good": true}]}, {"name": "アスクセクシーモア", "races": [{"date": "2025/11/23", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "秋色S(3勝クラス)", "result": 9, "cushion": 9.2, "moisture": 14.4, "cat": "diff_dist", "good": false}, {"date": "2025/11/01", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "紅葉S(3勝クラス)", "result": 8, "cushion": 9.1, "moisture": 15.6, "cat": "diff_dist", "good": false}, {"date": "2025/08/30", "venue": "新潟", "surface": "芝", "distance": 1800, "race_name": "赤倉特別(2勝クラス)", "result": 1, "cushion": 9.4, "moisture": 10.6, "cat": "diff_dist", "good": true}, {"date": "2025/06/15", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "芦ノ湖特別(2勝クラス)", "result": 3, "cushion": 8.7, "moisture": 17.7, "cat": "diff_dist", "good": true}, {"date": "2025/04/27", "venue": "東京", "surface": "芝", "distance": 1600, "race_name": "3歳1勝クラス", "result": 1, "cushion": 9.2, "moisture": 13.9, "cat": "diff_dist", "good": true}, {"date": "2025/04/05", "venue": "阪神", "surface": "芝", "distance": 1600, "race_name": "チャーチルダウンズC(GIII)", "result": 6, "cushion": 9.2, "moisture": 12.1, "cat": "diff_dist", "good": false}, {"date": "2025/01/18", "venue": "中京", "surface": "芝", "distance": 1600, "race_name": "3歳未勝利", "result": 1, "cushion": 9.8, "moisture": 11.9, "cat": "diff_dist", "good": true}, {"date": "2024/11/09", "venue": "京都", "surface": "芝", "distance": 1600, "race_name": "2歳新馬", "result": 14, "cushion": 11.1, "moisture": 10.7, "cat": "diff_dist", "good": false}]}];
const TX = 9.7;
const TY = 12.1;
const TDIST = 2000;
const COLORS = { same_dist:'#dc2626', diff_dist:'#2563eb', diff_surface:'#94a3b8', target:'#d97706' };
const X_MIN = 7.0, X_MAX = 12.0;
const Y_MIN = 0, Y_MAX = 22;
let selectedHorses = new Set();
let highlightedPoints = new Set();
const canvas = document.getElementById('chart');
const ctx = canvas.getContext('2d');
const tooltipEl = document.getElementById('tooltip');
const hueStep = 360 / Math.max(HORSES.length, 1);
const horseColors = HORSES.map((_, i) => `hsl(${i * hueStep}, 65%, 55%)`);

function resize() {
  const rect = canvas.parentElement.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  canvas.width = rect.width * dpr; canvas.height = rect.height * dpr;
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0); draw();
}
function toCanvasX(v) { const p=50; const w=canvas.width/(window.devicePixelRatio||1)-p*2; return p+(v-X_MIN)/(X_MAX-X_MIN)*w; }
function toCanvasY(v) { const pt=20,pb=40; const h=canvas.height/(window.devicePixelRatio||1)-pt-pb; return pt+(1-(v-Y_MIN)/(Y_MAX-Y_MIN))*h; }

function draw() {
  const W=canvas.width/(window.devicePixelRatio||1), H=canvas.height/(window.devicePixelRatio||1);
  ctx.clearRect(0,0,W,H);
  ctx.strokeStyle='#f1f5f9'; ctx.lineWidth=1;
  for(let x=Math.ceil(X_MIN);x<=X_MAX;x+=0.5){ const px=toCanvasX(x); ctx.beginPath();ctx.moveTo(px,20);ctx.lineTo(px,H-40);ctx.stroke(); ctx.fillStyle='#94a3b8';ctx.font='10px monospace';ctx.textAlign='center';ctx.fillText(x.toFixed(1),px,H-25); }
  for(let y=0;y<=Y_MAX;y+=2){ const py=toCanvasY(y); ctx.beginPath();ctx.moveTo(50,py);ctx.lineTo(W-50,py);ctx.stroke(); ctx.fillStyle='#94a3b8';ctx.font='10px monospace';ctx.textAlign='right';ctx.fillText(y+'%',45,py+4); }
  ctx.fillStyle='#64748b';ctx.font='bold 11px sans-serif';ctx.textAlign='center';
  ctx.fillText('クッション値',W/2,H-5);
  ctx.save();ctx.translate(12,H/2);ctx.rotate(-Math.PI/2);ctx.fillText('含水率（ゴール前）%',0,0);ctx.restore();
  ctx.fillStyle='rgba(59,130,246,0.04)';
  let sx0=toCanvasX(TX-0.5),sx1=toCanvasX(TX+0.5),sy0=toCanvasY(TY+3),sy1=toCanvasY(TY-3);
  ctx.fillRect(sx0,sy0,sx1-sx0,sy1-sy0);
  ctx.fillStyle='rgba(16,185,129,0.1)';
  let ix0=toCanvasX(TX-0.2),ix1=toCanvasX(TX+0.2),iy0=toCanvasY(TY+1.5),iy1=toCanvasY(TY-1.5);
  ctx.fillRect(ix0,iy0,ix1-ix0,iy1-iy0);
  ctx.setLineDash([5,5]);ctx.strokeStyle='#e2e8f0';ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(toCanvasX(TX),20);ctx.lineTo(toCanvasX(TX),H-40);ctx.stroke();
  ctx.beginPath();ctx.moveTo(50,toCanvasY(TY));ctx.lineTo(W-50,toCanvasY(TY));ctx.stroke();
  ctx.setLineDash([]);
  const hlDeferred=[];
  HORSES.forEach((h,hi)=>{
    const isSel=selectedHorses.has(h.name), dimmed=selectedHorses.size>0&&!isSel;
    const alpha=dimmed?0.08:(isSel?1.0:0.7);
    h.races.forEach((r,ri)=>{
      const isHL=highlightedPoints.has(hi+'-'+ri);
      if(isHL){hlDeferred.push({h,hi,r,ri,isSel,dimmed,alpha});return;}
      const px=toCanvasX(r.cushion),py=toCanvasY(r.moisture),color=COLORS[r.cat];
      const sz=isSel?15:10;
      ctx.globalAlpha=alpha;
      if(r.good){ ctx.beginPath();ctx.arc(px,py,sz,0,Math.PI*2);ctx.fillStyle='#fff';ctx.fill();ctx.strokeStyle=color;ctx.lineWidth=isSel?3.5:2;ctx.stroke(); }
      else{ ctx.strokeStyle=color;ctx.lineWidth=isSel?3.5:2;ctx.beginPath();ctx.moveTo(px-sz,py-sz);ctx.lineTo(px+sz,py+sz);ctx.stroke();ctx.beginPath();ctx.moveTo(px+sz,py-sz);ctx.lineTo(px-sz,py+sz);ctx.stroke(); }
      if(!dimmed){ ctx.fillStyle=color;ctx.font=`bold ${isSel?11:8}px Arial`;ctx.textAlign='center';ctx.textBaseline='middle';ctx.strokeStyle='#fff';ctx.lineWidth=2.5;ctx.strokeText(r.result||'?',px,py+1);ctx.fillText(r.result||'?',px,py+1); }
    });
  });
  hlDeferred.forEach(({h,hi,r,ri})=>{
    const px=toCanvasX(r.cushion),py=toCanvasY(r.moisture),color=COLORS[r.cat];
    const sz=18;
    ctx.globalAlpha=1.0;
    ctx.strokeStyle='#f59e0b';ctx.lineWidth=5;ctx.beginPath();ctx.arc(px,py,sz+6,0,Math.PI*2);ctx.stroke();
    if(r.good){ ctx.beginPath();ctx.arc(px,py,sz,0,Math.PI*2);ctx.fillStyle='#fffbeb';ctx.fill();ctx.strokeStyle='#f59e0b';ctx.lineWidth=4;ctx.stroke(); }
    else{ ctx.strokeStyle='#f59e0b';ctx.lineWidth=4;ctx.beginPath();ctx.moveTo(px-sz,py-sz);ctx.lineTo(px+sz,py+sz);ctx.stroke();ctx.beginPath();ctx.moveTo(px+sz,py-sz);ctx.lineTo(px-sz,py+sz);ctx.stroke(); }
    ctx.fillStyle='#f59e0b';ctx.font='bold 13px Arial';ctx.textAlign='center';ctx.textBaseline='middle';ctx.strokeStyle='#fff';ctx.lineWidth=2.5;ctx.strokeText(r.result||'?',px,py+1);ctx.fillText(r.result||'?',px,py+1);
  });
  ctx.globalAlpha=1;
  const RANK_COLORS={S:'#dc2626',A:'#f59e0b',B:'#3b82f6',C:'#22c55e',D:'#94a3b8'};
  HORSES.forEach((h,hi)=>{
    if(ratings[h.name]){
      const rank=ratings[h.name];const rc=RANK_COLORS[rank];
      h.races.forEach(r=>{
        const px=toCanvasX(r.cushion),py=toCanvasY(r.moisture);
        ctx.globalAlpha=selectedHorses.size>0&&!selectedHorses.has(h.name)?0.15:1;
        ctx.fillStyle=rc;ctx.font='bold 9px Arial';ctx.textAlign='left';
        ctx.fillText(rank,px+10,py-8);
      });
    }
  });
  ctx.globalAlpha=1;
  const tx=toCanvasX(TX),ty=toCanvasY(TY);
  ctx.fillStyle=COLORS.target;ctx.font='bold 22px Arial';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.strokeStyle='#fff';ctx.lineWidth=3;ctx.strokeText('★',tx,ty);ctx.fillText('★',tx,ty);
  ctx.textBaseline='alphabetic';
}
const ratings = {};
function buildPanel(){
  const panel=document.getElementById('panel');
  const RANKS=['S','A','B','C','D'];
  let html='';
  HORSES.forEach((h,i)=>{
    const cnt=h.races.length;
    html+=`<button class="horse-btn" id="btn-${i}"><span class="dot" style="background:${horseColors[i]}"></span>${h.name}<span class="count">${cnt>0?cnt+'走':'データなし'}</span></button>`;
    html+=`<div class="rating-row" id="rate-${i}">`;
    RANKS.forEach(r=>{html+=`<button class="rating-btn" data-horse="${i}" data-rank="${r}">${r}</button>`;});
    html+=`</div>`;
    html+=`<div class="horse-detail" id="detail-${i}"><div class="race-card">${h.races.map((r,ri)=>{const inIdeal=Math.abs(r.cushion-TX)<=0.2&&Math.abs(r.moisture-TY)<=1.5;return`<div class="race-item ${inIdeal?'ideal':''}" data-horse="${i}" data-ri="${ri}"><div class="date">${r.date} ${r.venue}</div><div class="rname">${r.race_name}</div><div class="cond">${r.surface}${r.distance}m ${r.distance===TDIST?'(同)':r.distance>TDIST?'(短)':'(延)'}</div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:2px"><span style="font-size:9px;color:#94a3b8">CV${r.cushion} / ${r.moisture}%</span><span class="result" style="color:${COLORS[r.cat]}">${r.result!==null?r.result+'着':'取消'}</span></div></div>`}).join('')}</div></div>`;
  });
  panel.innerHTML=html;
  HORSES.forEach((h,i)=>{document.getElementById('btn-'+i).addEventListener('click',()=>{
    const detail=document.getElementById('detail-'+i);
    if(selectedHorses.has(h.name)){selectedHorses.delete(h.name);detail.classList.remove('show');document.getElementById('btn-'+i).classList.remove('selected');}
    else{selectedHorses.add(h.name);detail.classList.add('show');document.getElementById('btn-'+i).classList.add('selected');}
    requestAnimationFrame(()=>{draw();});
  });});
  document.querySelectorAll('.rating-btn').forEach(btn=>{
    btn.addEventListener('click',(e)=>{
      e.stopPropagation();
      const hi=parseInt(btn.dataset.horse);
      const rank=btn.dataset.rank;
      const name=HORSES[hi].name;
      if(ratings[name]===rank){delete ratings[name];}
      else{ratings[name]=rank;}
      updateRatings();
    });
  });
  document.querySelectorAll('.race-item').forEach(el=>{
    el.addEventListener('click',(e)=>{
      e.stopPropagation();
      el.classList.toggle('highlighted');
      const key=el.dataset.horse+'-'+el.dataset.ri;
      if(highlightedPoints.has(key))highlightedPoints.delete(key);else highlightedPoints.add(key);
      requestAnimationFrame(()=>{draw();});
    });
  });
}
function updateRatings(){
  document.querySelectorAll('.rating-btn').forEach(btn=>{
    const hi=parseInt(btn.dataset.horse);
    const rank=btn.dataset.rank;
    const name=HORSES[hi].name;
    btn.className='rating-btn'+(ratings[name]===rank?' rated-'+rank:'');
  });
  draw();
}
const isMobile='ontouchstart' in window;
function getPointAt(cx,cy){
  let closest=null,minDist=isMobile?35:20;
  HORSES.forEach(h=>{if(selectedHorses.size>0&&!selectedHorses.has(h.name))return;h.races.forEach(r=>{const px=toCanvasX(r.cushion),py=toCanvasY(r.moisture),d=Math.sqrt((cx-px)**2+(cy-py)**2);if(d<minDist){minDist=d;closest={...r,horse:h.name};}});});
  return closest;
}
canvas.addEventListener('mousemove',(e)=>{const rect=canvas.getBoundingClientRect();const x=e.clientX-rect.left,y=e.clientY-rect.top;const pt=getPointAt(x,y);if(pt){tooltipEl.innerHTML=`<b>${pt.horse}</b><br>${pt.date} ${pt.venue} ${pt.surface}${pt.distance}m<br>${pt.race_name}<br><b>${pt.result}着</b><br>CV: ${pt.cushion} / 含水率: ${pt.moisture}%`;tooltipEl.style.left=(e.clientX+15)+'px';tooltipEl.style.top=(e.clientY-10)+'px';tooltipEl.classList.add('show');}else{tooltipEl.classList.remove('show');}});
canvas.addEventListener('mouseleave',()=>tooltipEl.classList.remove('show'));
let touchTimer=null;
function showTooltipAt(cx,cy,tx,ty){const pt=getPointAt(cx,cy);if(pt){tooltipEl.innerHTML=`<b>${pt.horse}</b><br>${pt.date} ${pt.venue} ${pt.surface}${pt.distance}m<br>${pt.race_name}<br><b>${pt.result!==null?pt.result+'着':'取消'}</b><br>CV: ${pt.cushion} / 含水率: ${pt.moisture}%`;const left=Math.min(tx+15,window.innerWidth-260);const top=Math.max(ty-40,10);tooltipEl.style.left=left+'px';tooltipEl.style.top=top+'px';tooltipEl.classList.add('show');}else{tooltipEl.classList.remove('show');}}
canvas.addEventListener('touchstart',(e)=>{const t=e.touches[0];const rect=canvas.getBoundingClientRect();showTooltipAt(t.clientX-rect.left,t.clientY-rect.top,t.clientX,t.clientY);},{passive:true});
canvas.addEventListener('touchmove',(e)=>{const t=e.touches[0];const rect=canvas.getBoundingClientRect();showTooltipAt(t.clientX-rect.left,t.clientY-rect.top,t.clientX,t.clientY);},{passive:true});
canvas.addEventListener('touchend',()=>{if(touchTimer)clearTimeout(touchTimer);touchTimer=setTimeout(()=>tooltipEl.classList.remove('show'),2000);});
canvas.addEventListener('click',(e)=>{const rect=canvas.getBoundingClientRect();showTooltipAt(e.clientX-rect.left,e.clientY-rect.top,e.clientX,e.clientY);});
window.addEventListener('resize',resize); buildPanel(); resize();
</script>
</body></html>